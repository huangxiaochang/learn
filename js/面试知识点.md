# 1. jsonp实现

```
function jsonp (options={}) {
	/*
		jsonp的原理是利用具有src, href属性，可以请求跨域请求的标签来发起一个get请求.
		如script, img, link, iframe标签等。除了script标签可以添加回调来获取到后端的数据，
		其他的标签是不能得到后端返回的数据的。因为其他标签返回的不是js脚本。不行执行回调函数。
		所以在不需要获取后端数据的get请求，可以使用img,iframe等标签发起jsonp请求（可以通过标签的
		onerror,load等事件来获取接口的成功或者失败，但是获取不到返回的数据）。
	*/
	if (!options.url) {
		return false;
	}
	const params = (options.params || {});
	var keys = Object.keys(params);
	let query = '?';
	for (let k of keys) {
		query += `${k}=${params}&`;
	}
	// jsonp的回调会执行全局环境下的函数（因为后端会返回`callback(data)`的js脚本，所以会在全局环境下执行）
	let precb = window.callback;
	window.callback = options.callback;
	query += `callback=${window.callback}`;
	let script = document.createElement('script');
	script.src = `${options.url}${query}`;
	// 请求成功后，移除script标签
	script.onload = script.onerror = function () {
		window.callback = precb;
		document.body.removeChild(script);
	}
	document.body.append(script);
}
```
# 2. 防止网站被其他页面的iframe套住的方法

1. 设置响应头X-Frame-Options来指示浏览器允许一个页面是否在<iframe><object>等展示标记中显示。
- DENY: 表示该页面不允许在iframe中展示。
- SAMEEORIGIN: 表示该页面可以在同域中展示。
- ALLOW-FROM:URL。表示可以在指定来源的iframe中展示。

2. 通过脚本来控制
```
if (window !== window.top) { // 或者self !==window.top
	// 跳转到自己的网站
	window.location.href = 'http://localhost:8888/bug.html'
}
```

# 3.消除闭包
闭包的主要是要访问父级作用域中的变量，所以要消除闭包，只需要把函数和它的父级作用域一起返回即可。
如：
```
// 闭包
function fun () {
	var a = 11;
	function fn (b) {
		console.log(a + b)
	}
	return fn;
}
// 消除闭包
function fun () {
	var a = 1;
	function fn (b) {
		console.log(a + b);
	}
	return {
		a: 1,
		fn: fn
	};
}
var obj = fun();
obj.fn(1, ...obj);
```
   

